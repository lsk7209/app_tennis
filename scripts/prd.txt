# ğŸ¾ Tennis Friends â€” MVP PRD v1.0 (Cursor AI ê°œë°œìš©)

---

## Goal

**ê·¼ê±°ë¦¬Â·ì‹œê°„ëŒ€ ê¸°ë°˜ì˜ ì‹ ë¢° ì¤‘ì‹¬ í…Œë‹ˆìŠ¤ ë§¤ì¹­ ì•±**

Flutter + Firebase ê¸°ë°˜ MVPë¡œ ì¶œì‹œí•˜ë©°, **ì‹¬í”Œí•œ ë§¤ì¹­, ì•ˆì •ì ì¸ ì‹ ë¢°, ì›í™œí•œ ì†Œí†µ**ì„ í•µì‹¬ ê°€ì¹˜ë¡œ ë‘”ë‹¤.

---

## Acceptance

* ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ + ì „í™”ë²ˆí˜¸ ì¸ì¦ ì •ìƒ ì‘ë™
* ì˜¨ë³´ë”© ì‹œ ë‹‰ë„¤ì„Â·ì§€ì—­(ì§‘/ì§ì¥)Â·NTRP ì…ë ¥ ì™„ë£Œ
* í™ˆÂ·ë§¤ì¹­íƒ­ì—ì„œ ë§¤ì¹­ íƒìƒ‰ ë° ë“±ë¡ ê°€ëŠ¥
* ì‹ ì²­/ìŠ¹ì¸/ëŒ€ê¸°ì íŠ¸ëœì­ì…˜ ì •ìƒ ì²˜ë¦¬
* ì±„íŒ… ìë™ ìƒì„± ë° ì•Œë¦¼(FCM) ì—°ë™
* ë‚´ì •ë³´ì—ì„œ í”„ë¡œí•„Â·ì‹ ì²­ë‚´ì—­Â·ë§¤ì¹­ì´ë ¥ í™•ì¸
* ë§¤ë„ˆì˜¨ë„ ë‚´ë¶€ ì €ì¥, UI ë¹„ë…¸ì¶œ
* ì†Œí”„íŠ¸ í•„í„° ê¸°ë°˜ìœ¼ë¡œ ê·¼ê±°ë¦¬+ì‹œê°„ ìœ ì‚¬ ë§¤ì¹­ fallback í‘œì‹œ
* Firestore/Functions/Rules í…ŒìŠ¤íŠ¸ í†µê³¼

---

## Scope

* Flutter App: `/lib/features/{auth, onboarding, match, chat, profile}`
* Firebase Modules: Auth, Firestore, Functions, FCM
* State Mgmt: Riverpod
* Routing: go_router
* Data Model: freezed + json_serializable

---

## Clarify

* ë¡œê·¸ì¸ì€ **ì¹´ì¹´ì˜¤ SDK + Firebase ì»¤ìŠ¤í…€í† í°**
* ë³¸ì¸ì¸ì¦ì€ Firebase Phone Auth
* ì§€ì—­ì€ ì§‘Â·ì§ì¥ 2ê°œ (ë¬¸ìì—´ ì €ì¥, ì¶”í›„ ì¢Œí‘œ í™•ì¥)
* ë§¤ì¹­ì˜ ë‹¨ìœ„ëŠ” "1ê°œì˜ ê²½ê¸°(ì‹œê°„Â·ì¥ì†Œ ê¸°ì¤€)"
* ì±„íŒ…ì€ ë§¤ì¹­ í™•ì •ìë“¤ ê°„ ìë™ ìƒì„± (ë‹¨ì²´ì±„íŒ…)
* ë¦¬ë·°/ë§¤ë„ˆëŠ” ë‚´ë¶€ ë°ì´í„°ë§Œ, MVP UI ë¹„ë…¸ì¶œ
* ì•± ì–¸ì–´ëŠ” í•œêµ­ì–´ë§Œ, Pretendard í°íŠ¸ ì ìš©
* MVPì—ì„œëŠ” ê´€ë¦¬ì ê¸°ëŠ¥ ì œì™¸

---

## Constraints

* ì˜ì¡´ì„±: `flutter_riverpod`, `go_router`, `freezed`, `firebase_auth`, `cloud_firestore`, `firebase_functions`, `firebase_messaging`, `kakao_flutter_sdk_user`, `uuid`, `intl`
* App Check í™œì„±í™”
* Functions IP rate limit 10/min
* AsyncValueWidget íŒ¨í„´ ê°•ì œ
* ë¡œì»¬í…ŒìŠ¤íŠ¸ Firebase Emulator í—ˆìš©

---

## Deliver

**ë³€ê²½íŒŒì¼ ëª©ë¡**

```
lib/
  app/{app.dart,router.dart,theme.dart,di.dart}
  core/{constants,utils,errors}
  data/{models,sources,repositories}
  features/
    auth/
    onboarding/
    match/
    chat/
    profile/
  widgets/
```

---

## 1. User Flow

```
ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ â†’ ì „í™”ë²ˆí˜¸ ì¸ì¦ â†’ ì˜¨ë³´ë”©(ë‹‰ë„¤ì„Â·ì§€ì—­2ê°œÂ·NTRPÂ·ë™ì˜)
 â†“
í™ˆ(ì¶”ì²œ ë§¤ì¹­) â†’ ë§¤ì¹­ ë“±ë¡ or íƒìƒ‰
 â†“
ì‹ ì²­ â†’ í˜¸ìŠ¤íŠ¸ ìŠ¹ì¸/ê±°ì ˆ â†’ ì±„íŒ… ìë™ ìƒì„±
 â†“
ë§¤ì¹­ ì¢…ë£Œ â†’ ë¦¬ë·°(ë‚´ë¶€ì €ì¥) â†’ ë‚´ì •ë³´ í™•ì¸
```

---

## 2. Screens Overview

| íƒ­   | í™”ë©´         | ì£¼ìš” ê¸°ëŠ¥                    |
| --- | ---------- | ------------------------ |
| í™ˆ   | ì˜¤ëŠ˜ì˜ ë§¤ì¹­ ì¶”ì²œ  | FAB(+)ë¡œ ë“±ë¡ ì§„ì…, ê·¼ê±°ë¦¬+ì‹œê°„ ì¤‘ì‹¬ |
| ë§¤ì¹­  | í•„í„°+ë¦¬ìŠ¤íŠ¸ íƒìƒ‰  | ì†Œí”„íŠ¸ í•„í„°, fallback ë§¤ì¹­ ë…¸ì¶œ   |
| ì±„íŒ…  | ë§¤ì¹­ í™•ì • ê·¸ë£¹ì±„íŒ… | ë©”ì‹œì§€, ì´ë¯¸ì§€, ì•Œë¦¼             |
| ë‚´ì •ë³´ | í”„ë¡œí•„Â·ì‹ ì²­Â·ì´ë ¥  | í†µê³„, ì•Œë¦¼ì„¤ì •, ë¡œê·¸ì•„ì›ƒ           |

---

## 3. Auth & Onboarding

| í•­ëª©     | ë‚´ìš©                                       |
| ------ | ---------------------------------------- |
| ë¡œê·¸ì¸    | ì¹´ì¹´ì˜¤ SDK â†’ Firebase CustomToken           |
| ì¸ì¦     | ì „í™”ë²ˆí˜¸(Firebase Auth)                      |
| ì˜¨ë³´ë”© ì…ë ¥ | ë‹‰ë„¤ì„, ì§€ì—­(ì§‘/ì§ì¥), NTRP, ë™ì˜                  |
| ë§¤ë„ˆì˜¨ë„   | ë‚´ë¶€ ì €ì¥ (ê¸°ë³¸ 36.5, ë¹„í‘œì‹œ)                     |
| ì €ì¥     | `/users/{uid}`, `/profiles_public/{uid}` |

---

## 4. Match Core Logic

| í•­ëª©      | ë‚´ìš©                                           |
| ------- | -------------------------------------------- |
| ë“±ë¡ í•„ë“œ   | ë‚ ì§œ, ì‹œê°„, ìœ„ì¹˜, ìœ í˜•, ì¸ì›, NTRPë²”ìœ„, ì‹œì„¤(ì£¼ì°¨/ê³µ/ë¬¼/ë¼ì¼“/ê¸°íƒ€) |
| ì‹ ì²­ ì œí•œ   | í™•ì •ë˜ì§€ ì•Šì€ ì‹ ì²­ ìµœëŒ€ 3ê°œ                             |
| ì¤‘ë³µ ì‹ ì²­   | ëŒ€ê¸° ìƒíƒœë§Œ ê°€ëŠ¥, í™•ì • ì‹œ ìë™ì·¨ì†Œ                         |
| í˜¸ìŠ¤íŠ¸ ê¸°ëŠ¥  | ì‹ ì²­ì ë³´ê¸° / ìˆ˜ë½ / ê±°ë¶€ / ëŒ€ê¸°ì 1ëª…                    |
| ìë™ ë¡œì§   | ìŠ¹ì¸ â†’ ì±„íŒ… ìƒì„± / í™•ì • â†’ íƒ€ ëŒ€ê¸° ìë™ì·¨ì†Œ / ì·¨ì†Œ â†’ ëŒ€ê¸°ì ìŠ¹ê²©    |
| íŠ¸ëœì­ì…˜ ì²˜ë¦¬ | Firestore batch or runTransaction ì‚¬ìš©         |

---

## 5. Filtering & Fallback Logic

| ë‹¨ê³„  | ì™„í™” ê¸°ì¤€                | ì„¤ëª…       |
| --- | -------------------- | -------- |
| 1ë‹¨ê³„ | ê±°ë¦¬ +5km / ì‹œê°„ê²¹ì¹¨ 15ë¶„   | ê·¼ê±°ë¦¬ ë™ì¼ì‹œê°„ |
| 2ë‹¨ê³„ | ê±°ë¦¬ +10km / NTRP Â±0.8 | ê±°ë¦¬Â·ì‹¤ë ¥ ì™„í™” |
| 3ë‹¨ê³„ | ê±°ë¦¬ +15km / ë™ì¼ìš”ì¼      | ìµì¼ ëŒ€ì²´ ì¶”ì²œ |

ì •ë ¬ì‹:
`score = 0.5*distance + 0.3*timeOverlap + 0.2*ntrpDiff`

---

## 6. Chat Logic

| í•­ëª©  | ë‚´ìš©                                        |
| --- | ----------------------------------------- |
| ìƒì„±  | ë§¤ì¹­ í™•ì • ì‹œ ìë™ `/chats/{matchId}`             |
| êµ¬ì„±  | í˜¸ìŠ¤íŠ¸ + ìŠ¹ì¸ì°¸ê°€ì                               |
| ë©”ì‹œì§€ | í…ìŠ¤íŠ¸, ì´ë¯¸ì§€(2MB ì´í•˜)                          |
| ìƒíƒœ  | active â†’ ended â†’ readonly(24h) â†’ archived |
| ì•Œë¦¼  | `chat-{matchId}` topic ê¸°ë°˜                 |
| ì •ë¦¬  | 30ì¼ í›„ ìë™ì‚­ì œ (Functions)                    |

---

## 7. Notifications (FCM)

| ëŒ€ìƒ  | ì´ë²¤íŠ¸                 | ì•Œë¦¼ ë‚´ìš©              |
| --- | ------------------- | ------------------ |
| í˜¸ìŠ¤íŠ¸ | ì°¸ê°€ì‹ ì²­ / ì·¨ì†Œ / ì±„íŒ…      | "ìƒˆ ì‹ ì²­ì´ ë„ì°©í–ˆìŠµë‹ˆë‹¤."    |
| ì‹ ì²­ì | ìŠ¹ì¸ / ê±°ë¶€ / ìë™ì·¨ì†Œ / ì±„íŒ… | "ë§¤ì¹­ì´ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤."     |
| ì „ì²´  | ì„ë°•ì•Œë¦¼                | "2ì‹œê°„ í›„ ë§¤ì¹­ì´ ì‹œì‘ë©ë‹ˆë‹¤." |

* FCM topic: `chat-{matchId}`
* ë”¥ë§í¬: `/match/{id}`, `/chat/{id}`
* ì‚¬ìš©ì ì„¤ì •: `/users/{uid}/preferences.notifications`

---

## 8. My Info

| í•­ëª©   | ë‚´ìš©                                           |
| ---- | -------------------------------------------- |
| í”„ë¡œí•„  | ì´ë¦„Â·ì´ë©”ì¼Â·íœ´ëŒ€í°(ì½ê¸°ì „ìš©), ë‹‰ë„¤ì„, ì§€ì—­(ì§‘Â·ì§ì¥), NTRP        |
| ì‹ ì²­ë‚´ì—­ | requested / waitlisted / approved / rejected |
| ë§¤ì¹­ì´ë ¥ | ìµœê·¼ 10ê±´ (ì§„í–‰/ì™„ë£Œ)                               |
| í†µê³„   | ë§¤ì¹­ ìˆ˜, ì™„ë£Œìœ¨, ë¦¬ë·°ìœ¨                               |
| ì„¤ì •   | ì•Œë¦¼ í† ê¸€(ë§¤ì¹­Â·ì±„íŒ…Â·ì‹œìŠ¤í…œ), ë¡œê·¸ì•„ì›ƒ, íƒˆí‡´                   |

---

## 9. Firestore Schema

```
users/{uid}{
  name,email,phone,nickname,
  region:{home,work},ntrp,
  manner:{score:36.5,hidden:true},
  fcmTokens[],
  preferences:{notifications:{match:true,chat:true,system:true}},
  createdAt
}

matches/{matchId}{
  hostId,users:[uid],waitlist:[uid],
  region,geohashPrefix,
  time:{start,end},
  ntrpRange:[min,max],
  facilities:{parking,balls,water,racket,etc},
  state:"open|matched|completed",
  createdAt
}

requests/{reqId}{
  matchId,applicantId,status, rejectCode?, createdAt
}

chats/{matchId}/messages/{msgId}{
  senderId,text?,imageUrl?,createdAt
}

users_private/{uid}/inbox/{notifId}{
  type,title,body,route,createdAt,read:false
}
```

---

## 10. Functions (Cloud)

| í•¨ìˆ˜                      | ê¸°ëŠ¥                     |
| ----------------------- | ---------------------- |
| `onRequestCreate`       | í˜¸ìŠ¤íŠ¸ì—ê²Œ ì‹ ì²­ ì•Œë¦¼            |
| `approveRequestTx`      | ìŠ¹ì¸ íŠ¸ëœì­ì…˜ (ëŒ€ê¸°ì ì²˜ë¦¬ í¬í•¨)    |
| `autoCancelConflictsTx` | ì¤‘ë³µì‹ ì²­ ìë™ ì·¨ì†Œ             |
| `promoteWaitlistTx`     | ëŒ€ê¸°ì ìë™ ìŠ¹ê²©              |
| `onChatMessage`         | ì±„íŒ… í‘¸ì‹œ                  |
| `onMatchReminder`       | ê²½ê¸° 2ì‹œê°„ ì „ ì•Œë¦¼            |
| `cleanupHistory`        | ë§¤ì¹­ 10ê±´ ìœ ì§€, ì±„íŒ… 30ì¼ í›„ ì‚­ì œ |

---

## 11. Rules (ìš”ì•½)

```
match /users/{uid}{
  allow read,write: if request.auth.uid==uid;
}

match /matches/{id}{
  allow read: if true;
  allow write: if request.auth.uid==resource.data.hostId;
}

match /requests/{id}{
  allow create: if request.auth.uid==request.resource.data.applicantId;
  allow read: if request.auth.uid in [resource.data.applicantId, get(/databases/$(database)/documents/matches/$(resource.data.matchId)).data.hostId];
}

match /chats/{id}{
  allow read,write: if request.auth.uid in resource.data.members && resource.data.state=="active";
}
```

---

## 12. Performance & Test

| í•­ëª©           | ëª©í‘œ                                |
| ------------ | --------------------------------- |
| ì²« ë Œë”ë§        | < 2.0s                            |
| í¬ë˜ì‹œí”„ë¦¬ìœ¨       | â‰¥ 99%                             |
| Firestore ì§€ì—° | < 300ms                           |
| ë™ì‹œì„± ì‹¤íŒ¨       | 0ê±´                                |
| í…ŒìŠ¤íŠ¸          | ìŠ¹ì¸/ìŠ¹ê²©/ì·¨ì†Œ íŠ¸ëœì­ì…˜ / ì¸ë±ìŠ¤ ê²€ì¦ / ì•Œë¦¼ ìˆ˜ì‹  í™•ì¸ |

---

## 13. MVP ì™„ë£Œ ì¡°ê±´

* ë¡œê·¸ì¸â€“ì˜¨ë³´ë”©â€“íƒìƒ‰â€“ì‹ ì²­â€“ìŠ¹ì¸â€“ì±„íŒ…â€“ì•Œë¦¼ ì „ì²´ í”Œë¡œìš° ì •ìƒ ì‘ë™
* Fallback ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜ 3ë‹¨ê³„ ì‘ë™
* Firestore ì¸ë±ìŠ¤ ë° íŠ¸ëœì­ì…˜ ê²€ì¦ ì™„ë£Œ
* Functions ë° Rules í…ŒìŠ¤íŠ¸ í†µê³¼

---

## 14. KPI

| í•­ëª©             | ëª©í‘œ     |
| -------------- | ------ |
| ì²« ë§¤ì¹­ í™•ì •ê¹Œì§€ í‰ê· ì‹œê°„ | â‰¤ 24ì‹œê°„ |
| ì‹ ì²­â†’í™•ì • ì „í™˜ìœ¨      | â‰¥ 30%  |
| ë¦¬ë·° ì‘ì„±ë¥          | â‰¥ 70%  |
| 7ì¼ ì¬ë°©ë¬¸ìœ¨        | â‰¥ 50%  |

---

